# 数据访问


数据库是应用服务开发的基础与核心。框架本身使用`Entity Framework Core`作为数据访问的ORM框架，提供了对数据库的访问能力。


使用`Entity Framework Core`不仅仅是为了方便，更重要的是规范了数据开发和访问的方式。

我们以`Code First`的方式来定义数据模型，然后使用`DbContext`来访问数据库。

## 读写分离

框架默认提供了`CommandDbContext`和`QueryDbContext`两个`DbContext`，分别用于数据的读和写操作。

我们抽象了一层`DataAccessContext`，并提供了`ManagerBase<TEntity>`基础类来使用`DataAccessContext`中的`CommandContext`和`QueryContext`。

对于常见的开发需求，我们只需要继承`ManagerBase<TEntity>`，优先使用父类提供的方法即可，并不用关心使用的是`CommandContext`和`QueryContext`，查询我们会默认使用`QueryContext`，并且不会追踪，即默认使用`AsNoTracking()`，而对于数据的增删改操作，我们会默认使用`CommandContext`。

当然你也可以直接使用`CommandContext`和`QueryContext`，来实现更复杂的操作，但你要自己处理不同上下文的数据追踪问题。

> [!IMPORTANT]
> 如果一个业务实现仅为查询，请使用`QueryContext`。
> 
> 如果业务实现涉及多种操作，为了避免不同上下文的冲突，可仅使用`CommandContext`来实现所有的操作。

## 租户模式

在有些场景下，我们需要支持多租户的模式，比如SaaS应用。不同的租户使用不同的数据库，这样可以保证数据的隔离性。也能为不同租户提供不同的功能和服务。

框架默认提供了`ITenantProvider`接口来获取租户信息。

我们要使用租户信息，来构建`DbContext`，我们提供了`TenantDbFactory`类来根据租户信息来创建`DbContext`。

你需要自定义`TenantDbFactory`中的创建方法，以获取对应的数据库连接字符串。

